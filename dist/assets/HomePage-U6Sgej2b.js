import{r as g,j as e}from"./vendor-react-Bo3cQ_TK.js";import{a as C,u as j,b as q}from"./vendor-@tanstack/react-query-lopZVymo.js";import{g as v,p as S,s as M,a as R,b as D,c as I,d as L}from"./index-DQ0mgkBK.js";import{g as k,c as w}from"./utils-BbEdXaft.js";import{F as U}from"./Footer-CI0iJmJz.js";import{f as N}from"./vendor-date-fns-CBpsKyOP.js";import{e as T,C as E,f as P}from"./vendor-lucide-react-KOu-6D8R.js";import"./vendor-@braintree/sanitize-url-DeNCW9ZR.js";import"./vendor-@tanstack/query-core-DAkWDcjV.js";import"./vendor-react-dom-CbvJyPzC.js";import"./vendor-scheduler-SPyfQU6S.js";import"./vendor-stream-chat-react-CVeHLvwq.js";import"./vendor-lodash.uniqby-o8VmXIMf.js";import"./vendor-lodash.debounce-DhtYb4E1.js";import"./vendor-use-sync-external-store-Dsyqmxci.js";import"./vendor-lodash.throttle-BqvSXoUA.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-stream-chat-DtQVF-Ea.js";import"./vendor-react-virtuoso-DpD_voqt.js";import"./vendor-@virtuoso.dev/react-urx-CwfggSdY.js";import"./vendor-@virtuoso.dev/urx-Bc7K0oMT.js";import"./vendor-nanoid-vcSNLBTf.js";import"./vendor-@react-aria/focus-DyN1FM9a.js";import"./vendor-@react-aria/utils-CNos-E2M.js";import"./vendor-@react-stately/flags-DVfiET8C.js";import"./vendor-@react-aria/interactions-D3-p4Otx.js";import"./vendor-react-popper-Bi3IUdiI.js";import"./vendor-react-fast-compare-CVeK3Sao.js";import"./vendor-@popperjs/core-CMBiYTiD.js";import"./vendor-linkifyjs-Dyj3p5Qy.js";import"./vendor-devlop-Cl3hj7Sz.js";import"./vendor-unified-BPQu4Iyo.js";import"./vendor-bail-FqpXQuLt.js";import"./vendor-extend-pH78Rfqk.js";import"./vendor-is-plain-obj-C1gvLhAf.js";import"./vendor-trough-B_b8ryxu.js";import"./vendor-vfile-BvTbaM8R.js";import"./vendor-vfile-message-BQOapXvP.js";import"./vendor-unist-util-stringify-position-Ch_qCilz.js";import"./vendor-remark-parse-CNDkPE6C.js";import"./vendor-mdast-util-from-markdown-CHHsmDpx.js";import"./vendor-micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./vendor-micromark-util-decode-string-fHsnqYdj.js";import"./vendor-decode-named-character-reference-C3-224fz.js";import"./vendor-micromark-util-normalize-identifier-C9ANKk3v.js";import"./vendor-micromark-Dc687xHH.js";import"./vendor-micromark-util-combine-extensions-d8XJZrgA.js";import"./vendor-micromark-util-chunked-DrRIdSP-.js";import"./vendor-micromark-factory-space-BM4zcA-B.js";import"./vendor-micromark-util-character-Cn8n62xE.js";import"./vendor-micromark-core-commonmark-BEN53qso.js";import"./vendor-micromark-util-classify-character-Bc1Mydac.js";import"./vendor-micromark-util-resolve-all-PQCKh0dx.js";import"./vendor-micromark-util-subtokenize-BF1Jf29a.js";import"./vendor-micromark-factory-destination-QK-4WEtY.js";import"./vendor-micromark-factory-label-Bo_B4AwM.js";import"./vendor-micromark-factory-title-D-E2MfTG.js";import"./vendor-micromark-factory-whitespace-D8F2YPRT.js";import"./vendor-micromark-util-html-tag-name-DbKNfynz.js";import"./vendor-mdast-util-to-string-C_aolqmU.js";import"./vendor-remark-rehype-CVyrzXe_.js";import"./vendor-mdast-util-to-hast-DKV8oL3N.js";import"./vendor-@ungap/structured-clone--gfxRhYI.js";import"./vendor-micromark-util-sanitize-uri-B-zxHmez.js";import"./vendor-unist-util-position-60F3QETU.js";import"./vendor-trim-lines-D8znQY54.js";import"./vendor-unist-util-visit-DyPrGnGc.js";import"./vendor-unist-util-visit-parents-CHe-IBUw.js";import"./vendor-unist-util-is-D9KQvrmg.js";import"./vendor-hast-util-to-jsx-runtime-yC-aVhS_.js";import"./vendor-comma-separated-tokens-xMQ5YY98.js";import"./vendor-property-information-Bx45xMUt.js";import"./vendor-space-separated-tokens-DD3iYX1K.js";import"./vendor-style-to-js-CeNL-GVX.js";import"./vendor-style-to-object-DmWTwRy6.js";import"./vendor-inline-style-parser-D4u_cg7q.js";import"./vendor-hast-util-whitespace-D4Wp6AEg.js";import"./vendor-estree-util-is-identifier-name-BgBfM8ME.js";import"./vendor-html-url-attributes-D46m5wfe.js";import"./vendor-unist-builder-_fSD7npn.js";import"./vendor-remark-gfm-BR6AH0GQ.js";import"./vendor-micromark-extension-gfm-CZUPGk5O.js";import"./vendor-micromark-extension-gfm-autolink-literal-zrBeIzAz.js";import"./vendor-micromark-extension-gfm-footnote-DC8zpk-O.js";import"./vendor-micromark-extension-gfm-strikethrough-r4kRFlAf.js";import"./vendor-micromark-extension-gfm-table-B99Gg4C5.js";import"./vendor-micromark-extension-gfm-task-list-item-BZuxQwYN.js";import"./vendor-mdast-util-gfm-BYI2EvPX.js";import"./vendor-mdast-util-gfm-autolink-literal-C7FXlFZ5.js";import"./vendor-ccount-c2V3InAJ.js";import"./vendor-mdast-util-find-and-replace-Dg3SkioO.js";import"./vendor-mdast-util-gfm-footnote-eRUj3PhO.js";import"./vendor-mdast-util-gfm-strikethrough-Cj9qKt6Q.js";import"./vendor-mdast-util-gfm-table-C80Z1anG.js";import"./vendor-markdown-table-DvhhVmnL.js";import"./vendor-mdast-util-to-markdown-CY_ELGXh.js";import"./vendor-longest-streak-CtXnX3Xp.js";import"./vendor-mdast-util-phrasing-GiRy56vE.js";import"./vendor-mdast-util-gfm-task-list-item-BI7eeOYA.js";import"./vendor-emoji-regex-GDmsnnpV.js";import"./vendor-hast-util-find-and-replace-C0YYBrQW.js";import"./vendor-hast-util-is-element-DyH4pHXM.js";import"./vendor-react-dropzone-B6nKeHd0.js";import"./vendor-prop-types-D7xSYF0k.js";import"./vendor-file-selector-B5Ihu03f.js";import"./vendor-tslib-Og7FjQ6G.js";import"./vendor-attr-accept-6DoZvs81.js";import"./vendor-react-textarea-autosize-QSVRh6BL.js";import"./vendor-@babel/runtime-Cv5OCJ0e.js";import"./vendor-use-latest-BtC_tkSB.js";import"./vendor-use-isomorphic-layout-effect-BsaTcJ-y.js";import"./vendor-use-composed-ref-B3Pr9MVu.js";import"./vendor-fix-webm-duration-BjaMVN9f.js";import"./vendor-lodash.mergewith-CZfHkFc_.js";import"./vendor-react-player-CSc_4svK.js";import"./vendor-load-script-B1B55cAN.js";import"./vendor-deepmerge-DMmwEoUs.js";import"./vendor-memoize-one-Cc18RrH6.js";import"./vendor-react-image-gallery-BcCdzhFS.js";import"./vendor-lodash.defaultsdeep-DpikQPb3.js";import"./vendor-dayjs-lAqYQP1A.js";import"./vendor-i18next-Bhc83OLH.js";import"./vendor-@stream-io/video-react-sdk-CFRFdeYP.js";import"./vendor-@stream-io/video-client-elMmITr2.js";import"./vendor-webrtc-adapter-DdV2dwuB.js";import"./vendor-sdp-B4BBrFNZ.js";import"./vendor-axios-Dq7h7Pqt.js";import"./vendor-ua-parser-js-CeJ9L3zE.js";import"./vendor-sdp-transform-qbGOjOZn.js";import"./vendor-rxjs-BlCF6R4j.js";import"./vendor-@protobuf-ts/runtime-GQ2FS7C6.js";import"./vendor-@protobuf-ts/runtime-rpc-0IXjfGUg.js";import"./vendor-@protobuf-ts/twirp-transport-BVWF-r8X.js";import"./vendor-@stream-io/video-react-bindings-CoI39B-Y.js";import"./vendor-@floating-ui/react-CRMhLyWA.js";import"./vendor-@floating-ui/utils-C3e6sfwQ.js";import"./vendor-tabbable-6_FK-X7s.js";import"./vendor-@floating-ui/react-dom-DpW997Or.js";import"./vendor-@floating-ui/dom-BZC8wnOe.js";import"./vendor-@floating-ui/core-CEm4j8qb.js";import"./vendor-chart.js-DDe540gX.js";import"./vendor-@kurkle/color-D8fDXNIl.js";import"./vendor-react-chartjs-2-DJ06sO3X.js";import"./vendor-react-router-DBwiWpbo.js";import"./vendor-cookie--_YQFYBD.js";import"./vendor-react-hot-toast-3PbAs2xd.js";import"./vendor-goober-np-fLvOt.js";import"./vendor-zustand-DhgEaKa0.js";const z=s=>{const c=new Date,a=new Date(c);a.setFullYear(c.getFullYear()-1),a.setDate(a.getDate()-a.getDay());const h=[];let o=new Date(a);for(;o<=c;){const m=N(o,"yyyy-MM-dd");h.push({date:m,month:o.getMonth(),checkedIn:s.includes(m)}),o.setDate(o.getDate()+1)}return h},A=({userId:s})=>{const[c,a]=g.useState([]),[h,o]=g.useState(!1),[m,u]=g.useState(""),[l,f]=g.useState(!1);g.useEffect(()=>{(async()=>{if(s){o(!0);try{console.log("ðŸ“¥ Fetching check-ins for:",s);const t=await v(s),n=(t==null?void 0:t.dates)||[];console.log("ðŸ“¦ Received check-in dates:",n),a(n),f(n.includes(N(new Date,"yyyy-MM-dd")))}catch(t){console.error("Error fetching check-in data:",t),u("Failed to load check-in data.")}finally{o(!1)}}})()},[s]);const b=async()=>{if(s){o(!0);try{console.log("ðŸ”„ Attempting to post check-in for:",s),await S(s),console.log("âœ… Successfully posted check-in!");const r=await v(s),t=(r==null?void 0:r.dates)||[];console.log("ðŸ“… Updated check-in dates fetched:",t),a(t);const n=N(new Date,"yyyy-MM-dd"),y=t.includes(n);console.log("ðŸ“† Checked in today?",y,"| Today:",n),f(y)}catch(r){console.error("Failed to check in",r),u("Check-in failed. Please try again.")}finally{o(!1)}}},x=z(c),p=[];for(let r=0;r<x.length;r+=7)p.push(x.slice(r,r+7));const i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F=p.map(r=>{const t=r[0];return d[t==null?void 0:t.month]});return e.jsxs("div",{className:"p-4 bg-base-200 rounded-lg w-full max-w-full hidden lg:block",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold tracking-tight mb-4",children:"Check-In Tracker"}),m&&e.jsx("div",{className:"alert alert-error mb-4",children:e.jsx("span",{children:m})}),e.jsx("button",{className:"btn btn-primary mb-4",onClick:b,disabled:h||l,children:l?"Already Checked In Today":h?"Checking in...":"Check In"}),e.jsx("div",{className:"overflow-x-auto rounded p-2 ",children:e.jsxs("div",{className:"min-w-[600px]",children:[e.jsx("div",{className:"flex pl-8 mb-1 text-xs text-gray-400",children:F.map((r,t)=>e.jsx("div",{className:"w-4 mr-1 text-center",children:t%4===0?r:""},t))}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex flex-col justify-between mr-2 text-xs text-gray-400",children:i.map((r,t)=>e.jsx("span",{children:t%2===1?r:""},t))}),e.jsx("div",{className:"flex",children:p.map((r,t)=>e.jsx("div",{className:"flex flex-col gap-1 mr-1",children:r.map((n,y)=>e.jsx("div",{title:n.date,className:`w-4 h-4 rounded-sm transition-colors duration-300 ${n.checkedIn?"bg-primary":"bg-gray-700"}`},y))},t))})]})]})})]})},Ci=()=>{const s=C(),[c,a]=g.useState(new Set),{data:h=[],isLoading:o}=j({queryKey:["friends"],queryFn:R}),{data:m=[],isLoading:u}=j({queryKey:["users"],queryFn:D}),{data:l}=j({queryKey:["outgoingFriendReqs"],queryFn:I}),{mutate:f,isPending:b}=q({mutationFn:M,onSuccess:()=>s.invalidateQueries({queryKey:["outgoingFriendReqs"]})});g.useEffect(()=>{const i=new Set;l&&l.length>0&&(l.forEach(d=>{i.add(d.recipient._id)}),a(i))},[l]);const{data:x}=j({queryKey:["currentUser"],queryFn:L}),p=x==null?void 0:x.user;return console.log("Current user in HomePage:",p),e.jsxs("div",{className:"",children:[p&&e.jsx(A,{userId:p._id}),e.jsx("div",{className:"p-4 sm:p-6 lg:p-8",children:e.jsx("div",{className:"container mx-auto space-y-10",children:e.jsxs("section",{children:[e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Meet New Learners"}),e.jsx("p",{className:"opacity-70",children:"Discover perfect language exchange partners based on your profile"})]})})}),u?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):m.length===0?e.jsxs("div",{className:"card bg-base-200 p-6 text-center",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No recommendations available"}),e.jsx("p",{className:"text-base-content opacity-70",children:"Check back later for new language partners!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-5",children:m.map(i=>{const d=c.has(i._id);return e.jsx("div",{className:"card bg-base-200 hover:shadow-lg transition-all duration-300",children:e.jsxs("div",{className:"card-body p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"avatar size-16 rounded-full",children:e.jsx("img",{src:i.profilePic,alt:i.fullName})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:i.fullName}),i.location&&e.jsxs("div",{className:"flex items-center text-xs opacity-70 mt-1",children:[e.jsx(T,{className:"size-3 mr-1"}),i.location]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsxs("span",{className:"badge badge-secondary",children:[k(i.nativeLanguage),"Native: ",w(i.nativeLanguage)]}),e.jsxs("span",{className:"badge badge-outline",children:[k(i.learningLanguage),"Learning: ",w(i.learningLanguage)]})]}),i.bio&&e.jsx("p",{className:"text-sm opacity-70",children:i.bio}),e.jsx("button",{className:`btn w-full mt-2 ${d?"btn-disabled":"btn-primary"} `,onClick:()=>f(i._id),disabled:d||b,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"size-4 mr-2"}),"Request Sent"]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"size-4 mr-2"}),"Send Friend Request"]})})]})},i._id)})})]})})}),e.jsx(U,{})]})};export{Ci as default};
