import{r as n,j as q}from"../vendor-react-Bo3cQ_TK.js";import{s as p,n as x,a as C,i as O,Q as T,M as d}from"./query-core-DAkWDcjV.js";var E=n.createContext(void 0),Q=e=>{const s=n.useContext(E);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},V=({client:e,children:s})=>(n.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),q.jsx(E.Provider,{value:e,children:s})),w=n.createContext(!1),M=()=>n.useContext(w);w.Provider;function P(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var _=n.createContext(P()),B=()=>n.useContext(_),k=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},H=e=>{n.useEffect(()=>{e.clearReset()},[e])},I=({result:e,errorResetBoundary:s,throwOnError:o,query:t,suspense:u})=>e.isError&&!s.isReset()&&!e.isFetching&&t&&(u&&e.data===void 0||p(o,[e.error,t])),j=e=>{if(e.suspense){const s=t=>t==="static"?t:Math.max(t??1e3,1e3),o=e.staleTime;e.staleTime=typeof o=="function"?(...t)=>s(o(...t)):s(o),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},F=(e,s)=>e.isLoading&&e.isFetching&&!s,D=(e,s)=>(e==null?void 0:e.suspense)&&s.isPending,b=(e,s,o)=>s.fetchOptimistic(e).catch(()=>{o.clearReset()});function N(e,s,o){var y,g,f,R,v;const t=M(),u=B(),i=Q(),r=i.defaultQueryOptions(e);(g=(y=i.getDefaultOptions().queries)==null?void 0:y._experimental_beforeQuery)==null||g.call(y,r),r._optimisticResults=t?"isRestoring":"optimistic",j(r),k(r,u),H(u);const h=!i.getQueryCache().get(r.queryHash),[a]=n.useState(()=>new s(i,r)),c=a.getOptimisticResult(r),m=!t&&e.subscribed!==!1;if(n.useSyncExternalStore(n.useCallback(l=>{const S=m?a.subscribe(x.batchCalls(l)):C;return a.updateResult(),S},[a,m]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),n.useEffect(()=>{a.setOptions(r)},[r,a]),D(r,c))throw b(r,a,u);if(I({result:c,errorResetBoundary:u,throwOnError:r.throwOnError,query:i.getQueryCache().get(r.queryHash),suspense:r.suspense}))throw c.error;if((R=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||R.call(f,r,c),r.experimental_prefetchInRender&&!O&&F(c,t)){const l=h?b(r,a,u):(v=i.getQueryCache().get(r.queryHash))==null?void 0:v.promise;l==null||l.catch(C).finally(()=>{a.updateResult()})}return r.notifyOnChangeProps?c:a.trackResult(c)}function z(e,s){return N(e,T)}function G(e,s){const o=Q(),[t]=n.useState(()=>new d(o,e));n.useEffect(()=>{t.setOptions(e)},[t,e]);const u=n.useSyncExternalStore(n.useCallback(r=>t.subscribe(x.batchCalls(r)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),i=n.useCallback((r,h)=>{t.mutate(r,h).catch(C)},[t]);if(u.error&&p(t.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:i,mutateAsync:u.mutate}}export{V as Q,Q as a,G as b,z as u};
