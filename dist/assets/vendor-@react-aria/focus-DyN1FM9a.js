import{$ as q,a as m,b as g,c as h,d as R,e as H,f as U,g as j,h as B,i as G}from"./utils-CNos-E2M.js";import{$ as J,a as W}from"./interactions-D3-p4Otx.js";import{r as N,a as L}from"../vendor-react-Bo3cQ_TK.js";function Y(e){const t=q(e);if(!(e instanceof t.HTMLElement)&&!(e instanceof t.SVGElement))return!1;let{display:r,visibility:i}=e.style,n=r!=="none"&&i!=="hidden"&&i!=="collapse";if(n){const{getComputedStyle:a}=e.ownerDocument.defaultView;let{display:u,visibility:o}=a(e);n=u!=="none"&&o!=="hidden"&&o!=="collapse"}return n}function Q(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&(e.nodeName==="DETAILS"&&t&&t.nodeName!=="SUMMARY"?e.hasAttribute("open"):!0)}function V(e,t){return e.nodeName!=="#comment"&&Y(e)&&Q(e,t)&&(!e.parentElement||V(e.parentElement,e))}const K=L.createContext(null),M="react-aria-focus-scope-restore";let s=null;function ae(e){let{children:t,contain:r,restoreFocus:i,autoFocus:n}=e,a=N.useRef(null),u=N.useRef(null),o=N.useRef([]),{parentNode:b}=N.useContext(K)||{},l=N.useMemo(()=>new A({scopeRef:o}),[o]);m(()=>{let c=b||$.root;if($.getTreeNode(c.scopeRef)&&s&&!_(s,c.scopeRef)){let f=$.getTreeNode(s);f&&(c=f)}c.addChild(l),$.addNode(l)},[l,b]),m(()=>{let c=$.getTreeNode(o);c&&(c.contain=!!r)},[r]),m(()=>{var c;let f=(c=a.current)===null||c===void 0?void 0:c.nextSibling,p=[],S=C=>C.stopPropagation();for(;f&&f!==u.current;)p.push(f),f.addEventListener(M,S),f=f.nextSibling;return o.current=p,()=>{for(let C of p)C.removeEventListener(M,S)}},[t]),te(o,i,r),Z(o,r),re(o,i,r),ee(o,n),N.useEffect(()=>{const c=g(h(o.current?o.current[0]:void 0));let f=null;if(E(c,o.current)){for(let p of $.traverse())p.scopeRef&&E(c,p.scopeRef.current)&&(f=p);f===$.getTreeNode(o)&&(s=f.scopeRef)}},[o]),m(()=>()=>{var c,f,p;let S=(p=(f=$.getTreeNode(o))===null||f===void 0||(c=f.parent)===null||c===void 0?void 0:c.scopeRef)!==null&&p!==void 0?p:null;(o===s||_(o,s))&&(!S||$.getTreeNode(S))&&(s=S),$.removeTreeNode(o)},[o]);let v=N.useMemo(()=>X(o),[]),d=N.useMemo(()=>({focusManager:v,parentNode:l}),[l,v]);return L.createElement(K.Provider,{value:d},L.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:a}),t,L.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:u}))}function X(e){return{focusNext(t={}){let r=e.current,{from:i,tabbable:n,wrap:a,accept:u}=t;var o;let b=i||g(h((o=r[0])!==null&&o!==void 0?o:void 0)),l=r[0].previousElementSibling,v=y(r),d=w(v,{tabbable:n,accept:u},r);d.currentNode=E(b,r)?b:l;let c=d.nextNode();return!c&&a&&(d.currentNode=l,c=d.nextNode()),c&&T(c,!0),c},focusPrevious(t={}){let r=e.current,{from:i,tabbable:n,wrap:a,accept:u}=t;var o;let b=i||g(h((o=r[0])!==null&&o!==void 0?o:void 0)),l=r[r.length-1].nextElementSibling,v=y(r),d=w(v,{tabbable:n,accept:u},r);d.currentNode=E(b,r)?b:l;let c=d.previousNode();return!c&&a&&(d.currentNode=l,c=d.previousNode()),c&&T(c,!0),c},focusFirst(t={}){let r=e.current,{tabbable:i,accept:n}=t,a=y(r),u=w(a,{tabbable:i,accept:n},r);u.currentNode=r[0].previousElementSibling;let o=u.nextNode();return o&&T(o,!0),o},focusLast(t={}){let r=e.current,{tabbable:i,accept:n}=t,a=y(r),u=w(a,{tabbable:i,accept:n},r);u.currentNode=r[r.length-1].nextElementSibling;let o=u.previousNode();return o&&T(o,!0),o}}}function y(e){return e[0].parentElement}function F(e){let t=$.getTreeNode(s);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function Z(e,t){let r=N.useRef(void 0),i=N.useRef(void 0);m(()=>{let n=e.current;if(!t){i.current&&(cancelAnimationFrame(i.current),i.current=void 0);return}const a=h(n?n[0]:void 0);let u=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!F(e)||l.isComposing)return;let v=g(a),d=e.current;if(!d||!E(v,d))return;let c=y(d),f=w(c,{tabbable:!0},d);if(!v)return;f.currentNode=v;let p=l.shiftKey?f.previousNode():f.nextNode();p||(f.currentNode=l.shiftKey?d[d.length-1].nextElementSibling:d[0].previousElementSibling,p=l.shiftKey?f.previousNode():f.nextNode()),l.preventDefault(),p&&T(p,!0)},o=l=>{(!s||_(s,e))&&E(R(l),e.current)?(s=e,r.current=R(l)):F(e)&&!x(R(l),e)?r.current?r.current.focus():s&&s.current&&k(s.current):F(e)&&(r.current=R(l))},b=l=>{i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{let v=W(),d=(v==="virtual"||v===null)&&H()&&U(),c=g(a);if(!d&&c&&F(e)&&!x(c,e)){s=e;let p=R(l);if(p&&p.isConnected){var f;r.current=p,(f=r.current)===null||f===void 0||f.focus()}else s.current&&k(s.current)}})};return a.addEventListener("keydown",u,!1),a.addEventListener("focusin",o,!1),n==null||n.forEach(l=>l.addEventListener("focusin",o,!1)),n==null||n.forEach(l=>l.addEventListener("focusout",b,!1)),()=>{a.removeEventListener("keydown",u,!1),a.removeEventListener("focusin",o,!1),n==null||n.forEach(l=>l.removeEventListener("focusin",o,!1)),n==null||n.forEach(l=>l.removeEventListener("focusout",b,!1))}},[e,t]),m(()=>()=>{i.current&&cancelAnimationFrame(i.current)},[i])}function O(e){return x(e)}function E(e,t){return!e||!t?!1:t.some(r=>r.contains(e))}function x(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of $.traverse($.getTreeNode(t)))if(r&&E(e,r.current))return!0;return!1}function _(e,t){var r;let i=(r=$.getTreeNode(t))===null||r===void 0?void 0:r.parent;for(;i;){if(i.scopeRef===e)return!0;i=i.parent}return!1}function T(e,t=!1){if(e!=null&&!t)try{J(e)}catch{}else if(e!=null)try{e.focus()}catch{}}function z(e,t=!0){let r=e[0].previousElementSibling,i=y(e),n=w(i,{tabbable:t},e);n.currentNode=r;let a=n.nextNode();return t&&!a&&(i=y(e),n=w(i,{tabbable:!1},e),n.currentNode=r,a=n.nextNode()),a}function k(e,t=!0){T(z(e,t))}function ee(e,t){const r=L.useRef(t);N.useEffect(()=>{if(r.current){s=e;const i=h(e.current?e.current[0]:void 0);!E(g(i),s.current)&&e.current&&k(e.current)}r.current=!1},[e])}function te(e,t,r){m(()=>{if(t||r)return;let i=e.current;const n=h(i?i[0]:void 0);let a=u=>{let o=R(u);E(o,e.current)?s=e:O(o)||(s=null)};return n.addEventListener("focusin",a,!1),i==null||i.forEach(u=>u.addEventListener("focusin",a,!1)),()=>{n.removeEventListener("focusin",a,!1),i==null||i.forEach(u=>u.removeEventListener("focusin",a,!1))}},[e,t,r])}function I(e){let t=$.getTreeNode(s);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(t==null?void 0:t.scopeRef)===e}function re(e,t,r){const i=N.useRef(typeof document<"u"?g(h(e.current?e.current[0]:void 0)):null);m(()=>{let n=e.current;const a=h(n?n[0]:void 0);if(!t||r)return;let u=()=>{(!s||_(s,e))&&E(g(a),e.current)&&(s=e)};return a.addEventListener("focusin",u,!1),n==null||n.forEach(o=>o.addEventListener("focusin",u,!1)),()=>{a.removeEventListener("focusin",u,!1),n==null||n.forEach(o=>o.removeEventListener("focusin",u,!1))}},[e,r]),m(()=>{const n=h(e.current?e.current[0]:void 0);if(!t)return;let a=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!F(e)||u.isComposing)return;let o=n.activeElement;if(!x(o,e)||!I(e))return;let b=$.getTreeNode(e);if(!b)return;let l=b.nodeToRestore,v=w(n.body,{tabbable:!0});v.currentNode=o;let d=u.shiftKey?v.previousNode():v.nextNode();if((!l||!l.isConnected||l===n.body)&&(l=void 0,b.nodeToRestore=void 0),(!d||!x(d,e))&&l){v.currentNode=l;do d=u.shiftKey?v.previousNode():v.nextNode();while(x(d,e));u.preventDefault(),u.stopPropagation(),d?T(d,!0):O(l)?T(l,!0):o.blur()}};return r||n.addEventListener("keydown",a,!0),()=>{r||n.removeEventListener("keydown",a,!0)}},[e,t,r]),m(()=>{const n=h(e.current?e.current[0]:void 0);if(!t)return;let a=$.getTreeNode(e);if(a){var u;return a.nodeToRestore=(u=i.current)!==null&&u!==void 0?u:void 0,()=>{let o=$.getTreeNode(e);if(!o)return;let b=o.nodeToRestore,l=g(n);if(t&&b&&(l&&x(l,e)||l===n.body&&I(e))){let v=$.clone();requestAnimationFrame(()=>{if(n.activeElement===n.body){let d=v.getTreeNode(e);for(;d;){if(d.nodeToRestore&&d.nodeToRestore.isConnected){P(d.nodeToRestore);return}d=d.parent}for(d=v.getTreeNode(e);d;){if(d.scopeRef&&d.scopeRef.current&&$.getTreeNode(d.scopeRef)){let c=z(d.scopeRef.current,!0);P(c);return}d=d.parent}}})}}}},[e,t])}function P(e){e.dispatchEvent(new CustomEvent(M,{bubbles:!0,cancelable:!0}))&&T(e)}function w(e,t,r){let i=t!=null&&t.tabbable?j:B,n=(e==null?void 0:e.nodeType)===Node.ELEMENT_NODE?e:null,a=h(n),u=G(a,e||a,NodeFilter.SHOW_ELEMENT,{acceptNode(o){var b;return!(t==null||(b=t.from)===null||b===void 0)&&b.contains(o)?NodeFilter.FILTER_REJECT:i(o)&&V(o)&&(!r||E(o,r))&&(!(t!=null&&t.accept)||t.accept(o))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t!=null&&t.from&&(u.currentNode=t.from),u}class D{get size(){return this.fastMap.size}getTreeNode(t){return this.fastMap.get(t)}addTreeNode(t,r,i){let n=this.fastMap.get(r??null);if(!n)return;let a=new A({scopeRef:t});n.addChild(a),a.parent=n,this.fastMap.set(t,a),i&&(a.nodeToRestore=i)}addNode(t){this.fastMap.set(t.scopeRef,t)}removeTreeNode(t){if(t===null)return;let r=this.fastMap.get(t);if(!r)return;let i=r.parent;for(let a of this.traverse())a!==r&&r.nodeToRestore&&a.nodeToRestore&&r.scopeRef&&r.scopeRef.current&&E(a.nodeToRestore,r.scopeRef.current)&&(a.nodeToRestore=r.nodeToRestore);let n=r.children;i&&(i.removeChild(r),n.size>0&&n.forEach(a=>i&&i.addChild(a))),this.fastMap.delete(r.scopeRef)}*traverse(t=this.root){if(t.scopeRef!=null&&(yield t),t.children.size>0)for(let r of t.children)yield*this.traverse(r)}clone(){var t;let r=new D;var i;for(let n of this.traverse())r.addTreeNode(n.scopeRef,(i=(t=n.parent)===null||t===void 0?void 0:t.scopeRef)!==null&&i!==void 0?i:null,n.nodeToRestore);return r}constructor(){this.fastMap=new Map,this.root=new A({scopeRef:null}),this.fastMap.set(null,this.root)}}class A{addChild(t){this.children.add(t),t.parent=this}removeChild(t){this.children.delete(t),t.parent=void 0}constructor(t){this.children=new Set,this.contain=!1,this.scopeRef=t.scopeRef}}let $=new D;export{ae as $};
