import{h as Z,O as x,c as Ie,s as Te,a as z,b as ie,d as J,e as Le,f as De,V as Oe,m as ne,g as Me,i as Ve,j as me,k as F,l as qe,n as Be}from"./video-client-elMmITr2.js";import{S as Fe,a as Ue,u as O,b as L,R as I,c as C,d as Ye}from"./video-react-bindings-CoI39B-Y.js";import{j as t,r as l}from"../vendor-react-Bo3cQ_TK.js";import{u as fe,F as $e,a as He,b as Ge,c as ze,d as Je,e as We,f as Ke,g as Qe,h as Xe,i as Ze,j as et,k as tt}from"../vendor-@floating-ui/react-CRMhLyWA.js";import{c as N}from"../vendor-clsx-B-dksMZM.js";import"../vendor-react-dom-CbvJyPzC.js";import{o as st,s as nt,f as _e,a as it,b as ot}from"../vendor-@floating-ui/react-dom-DpW997Or.js";import{d as ge}from"../vendor-@floating-ui/dom-BZC8wnOe.js";import{C as rt,a as at,L as ct,b as lt,P as dt}from"../vendor-chart.js-DDe540gX.js";import{L as ut}from"../vendor-react-chartjs-2-DJ06sO3X.js";const mt="modulepreload",pt=function(s){return"/"+s},pe={},ht=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){let a=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),m=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=a(n.map(d=>{if(d=pt(d),d in pe)return;pe[d]=!0;const u=d.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":mt,u||(h.as="script"),h.crossOrigin="",h.href=d,m&&h.setAttribute("nonce",m),document.head.appendChild(h),u)return new Promise((_,S)=>{h.addEventListener("load",_),h.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return r.then(a=>{for(const c of a||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})},G=({participant:s,trackType:e="audioTrack",...n})=>{const i=O(),[r,o]=l.useState(null),{userId:a,sessionId:c}=s;return l.useEffect(()=>{if(!i||!r)return;const m=i.bindAudioElement(r,c,e);return()=>{m==null||m()}},[i,c,r,e]),t.jsx("audio",{autoPlay:!0,...n,ref:o,"data-user-id":a,"data-session-id":c,"data-track-type":e})};G.displayName="Audio";const xe=s=>{const{participants:e,audioProps:n}=s;return t.jsx(t.Fragment,{children:e.map(i=>{if(i.isLocalParticipant)return null;const{audioStream:r,screenShareAudioStream:o,sessionId:a}=i,m=z(i)&&r&&t.jsx(G,{...n,trackType:"audioTrack",participant:i}),u=ie(i)&&o&&t.jsx(G,{...n,trackType:"screenShareAudioTrack",participant:i});return t.jsxs(l.Fragment,{children:[m,u]},a)})})};xe.displayName="ParticipantsAudio";const Se=l.createContext(void 0),ee=()=>l.useContext(Se),oe=({middleware:s=[],placement:e,strategy:n,offset:i=10})=>{const{refs:r,x:o,y:a,update:c,elements:{domReference:m,floating:d},context:u}=fe({placement:e,strategy:n,middleware:[st(i),nt(),_e(),it({padding:10,apply:({availableHeight:p,elements:h})=>{Object.assign(h.floating.style,{maxHeight:`${p}px`})}}),...s]});return l.useEffect(()=>{if(!m||!d)return;const p=ge(m,d,c);return()=>p()},[m,d,c]),{refs:r,x:o,y:a,domReference:m,floating:d,strategy:n,context:u}},je=10,vt=(s,e=je)=>{const[n,i]=l.useState(null);return l.useEffect(()=>{if(!s)return;const r=()=>{const a=s;if(!(a.scrollHeight>a.clientHeight))return i(null);if(a.scrollTop<=e)return i("top");if(Math.abs(a.scrollHeight-a.scrollTop-a.clientHeight)<=e)return i("bottom");i("between")},o=new ResizeObserver(r);return o.observe(s),s.addEventListener("scroll",r),()=>{s.removeEventListener("scroll",r),o.disconnect()}},[s,e]),n},ft=(s,e=je)=>{const[n,i]=l.useState(null);return l.useEffect(()=>{if(!s)return;const r=()=>{const a=s;if(!(a.scrollWidth>a.clientWidth))return i(null);if(a.scrollLeft<=e)return i("start");if(Math.abs(a.scrollWidth-a.scrollLeft-a.clientWidth)<=e)return i("end");i("between")},o=new ResizeObserver(r);return o.observe(s),s.addEventListener("scroll",r),()=>{s.removeEventListener("scroll",r),o.disconnect()}},[s,e]),n},re=s=>{const e=O(),{useHasPermissions:n}=L(),i=n(s),[r,o]=l.useState(!1);return l.useEffect(()=>{i&&o(!1)},[i]),{requestPermission:l.useCallback(async()=>{if(i)return!0;const c=!!(e!=null&&e.permissionsContext.canRequest(s));if(r||!c)return!1;o(!0);try{await(e==null?void 0:e.requestPermissions({permissions:[s]}))}catch(m){throw o(!1),new Error(`requestPermission failed: ${m}`)}return!1},[e,i,r,s]),hasPermission:i,canRequestPermission:!!(e!=null&&e.permissionsContext.canRequest(s)),isAwaitingPermission:r}};function be(s,e){const{t:n}=C();return l.useMemo(()=>{let i=null,r=null;const o=s.map((a,c)=>{const m=a.deviceId===e,d={deviceId:a.deviceId,label:a.label,isSelected:m};return m&&(i=d,r=c),d});if(i===null||r===null){const a={deviceId:"default",label:n("Default"),isSelected:!0};i=a,r=0,o.unshift(a)}return{deviceList:o,selectedDeviceInfo:i,selectedIndex:r}},[s,e,n])}var H;(function(s){s.PORTAL="portal",s.MENU="menu"})(H||(H={}));const ye=l.createContext({}),ae=()=>l.useContext(ye),_t=({children:s,refs:e})=>{const n=l.useMemo(()=>`str-video-portal-${Math.random().toString(36).substring(2,9)}`,[]);return t.jsxs(t.Fragment,{children:[t.jsx("div",{id:n,className:"str-video__portal"}),t.jsx($e,{children:t.jsx(He,{id:n,children:t.jsx("div",{className:"str-video__portal-content",ref:e.setFloating,children:s})})})]})},ce=({ToggleButton:s,placement:e="top-start",strategy:n="absolute",offset:i,visualType:r=H.MENU,children:o,onToggle:a})=>{const[c,m]=l.useState(!1),d=l.useRef(a);d.current=a;const{floating:u,domReference:p,refs:h,x:_,y:S}=oe({placement:e,strategy:n,offset:i});return l.useEffect(()=>{const v=p==null?void 0:p.ownerDocument,f=j=>{var y,w;!u&&(p!=null&&p.contains(j.target))?(m(!0),(y=d.current)==null||y.call(d,!0)):u&&!(u!=null&&u.contains(j.target))&&(m(!1),(w=d.current)==null||w.call(d,!1))},b=j=>{var y;j.key&&j.key.toLowerCase()==="escape"&&!j.altKey&&!j.ctrlKey&&(m(!1),(y=d.current)==null||y.call(d,!1))};return v==null||v.addEventListener("click",f,{capture:!0}),v==null||v.addEventListener("keydown",b),()=>{v==null||v.removeEventListener("click",f,{capture:!0}),v==null||v.removeEventListener("keydown",b)}},[u,p]),t.jsxs(t.Fragment,{children:[c&&t.jsx(ye.Provider,{value:{close:()=>m(!1)},children:r===H.PORTAL?t.jsx(_t,{refs:h,children:o}):r===H.MENU?t.jsx("div",{className:"str-video__menu-container",ref:h.setFloating,style:{position:n,top:S??0,left:_??0,overflowY:"auto"},role:"menu",children:o}):null}),t.jsx(s,{menuShown:c,ref:h.setReference})]})},gt=({children:s,onItemClick:e})=>{const n=l.useRef(null);return t.jsx("ul",{className:"str-video__generic-menu",ref:n,onClick:i=>{var r;e&&i.target!==n.current&&((r=n.current)!=null&&r.contains(i.target))&&e(i)},children:s})},E=({children:s,...e})=>t.jsx("li",{className:"str-video__generic-menu--item",children:t.jsx("button",{...e,children:s})}),P=({className:s,icon:e})=>t.jsx("span",{className:N("str-video__icon",e&&`str-video__icon--${e}`,s)});function Pe(s){const[e,n]=l.useState(document.pictureInPictureElement===s);return!s&&e&&n(!1),l.useEffect(()=>{if(!s)return;const i=()=>{n(document.pictureInPictureElement===s)};return s.addEventListener("enterpictureinpicture",i),s.addEventListener("leavepictureinpicture",i),()=>{s.removeEventListener("enterpictureinpicture",i),s.removeEventListener("leavepictureinpicture",i)}},[s]),e}const xt=()=>{const{participant:s,participantViewElement:e,videoElement:n}=ee(),[i,r]=l.useState(!!document.fullscreenElement),o=O(),a=Pe(n??void 0),{t:c}=C(),{pin:m,sessionId:d,userId:u}=s,p=z(s),h=J(s),_=Z(s),S=ie(s),v=()=>o==null?void 0:o.blockUser(u),f=()=>o==null?void 0:o.muteUser(u,"audio"),b=()=>o==null?void 0:o.muteUser(u,"video"),j=()=>o==null?void 0:o.muteUser(u,"screenshare"),y=()=>o==null?void 0:o.muteUser(u,"screenshare_audio"),w=k=>()=>{o==null||o.updateUserPermissions({user_id:u,grant_permissions:[k]})},R=k=>()=>{o==null||o.updateUserPermissions({user_id:u,revoke_permissions:[k]})},U=()=>{m?o==null||o.unpin(d):o==null||o.pin(d)},A=()=>{o==null||o.pinForEveryone({user_id:u,session_id:d}).catch(k=>{console.error(`Failed to pin participant ${u}`,k)})},M=()=>{o==null||o.unpinForEveryone({user_id:u,session_id:d}).catch(k=>{console.error(`Failed to unpin participant ${u}`,k)})},V=()=>i?document.exitFullscreen().catch(console.error):e==null?void 0:e.requestFullscreen().catch(console.error);l.useEffect(()=>{const k=()=>{r(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",k),()=>{document.removeEventListener("fullscreenchange",k)}},[]);const q=()=>n&&!a?n.requestPictureInPicture().catch(console.error):document.exitPictureInPicture().catch(console.error),{close:B}=ae()||{};return t.jsxs(gt,{onItemClick:B,children:[t.jsxs(E,{onClick:U,disabled:m&&!m.isLocalPin,children:[t.jsx(P,{icon:"pin"}),c(m?"Unpin":"Pin")]}),t.jsxs(I,{requiredGrants:[x.PIN_FOR_EVERYONE],children:[t.jsxs(E,{onClick:A,disabled:m&&!m.isLocalPin,children:[t.jsx(P,{icon:"pin"}),c("Pin for everyone")]}),t.jsxs(E,{onClick:M,disabled:!m||m.isLocalPin,children:[t.jsx(P,{icon:"pin"}),c("Unpin for everyone")]})]}),t.jsx(I,{requiredGrants:[x.BLOCK_USERS],children:t.jsxs(E,{onClick:v,children:[t.jsx(P,{icon:"not-allowed"}),c("Block")]})}),t.jsxs(I,{requiredGrants:[x.MUTE_USERS],children:[h&&t.jsxs(E,{onClick:b,children:[t.jsx(P,{icon:"camera-off-outline"}),c("Turn off video")]}),_&&t.jsxs(E,{onClick:j,children:[t.jsx(P,{icon:"screen-share-off"}),c("Turn off screen share")]}),p&&t.jsxs(E,{onClick:f,children:[t.jsx(P,{icon:"no-audio"}),c("Mute audio")]}),S&&t.jsxs(E,{onClick:y,children:[t.jsx(P,{icon:"no-audio"}),c("Mute screen share audio")]})]}),e&&typeof e.requestFullscreen<"u"&&t.jsx(E,{onClick:V,children:c("{{ direction }} fullscreen",{direction:c(i?"Leave":"Enter")})}),n&&document.pictureInPictureEnabled&&t.jsx(E,{onClick:q,children:c("{{ direction }} picture-in-picture",{direction:c(a?"Leave":"Enter")})}),t.jsxs(I,{requiredGrants:[x.UPDATE_CALL_PERMISSIONS],children:[t.jsx(E,{onClick:w(x.SEND_AUDIO),children:c("Allow audio")}),t.jsx(E,{onClick:w(x.SEND_VIDEO),children:c("Allow video")}),t.jsx(E,{onClick:w(x.SCREENSHARE),children:c("Allow screen sharing")}),t.jsx(E,{onClick:R(x.SEND_AUDIO),children:c("Disable audio")}),t.jsx(E,{onClick:R(x.SEND_VIDEO),children:c("Disable video")}),t.jsx(E,{onClick:R(x.SCREENSHARE),children:c("Disable screen sharing")})]})]})},ke=s=>s===null?!1:!l.isValidElement(s),Ne=(s,e)=>{if(s){if(typeof s=="function")return s(e);s.current=e}};l.forwardRef(function({stream:e,...n},i){const[r,o]=l.useState(null);return l.useEffect(()=>{if(!(!r||!e)&&e!==r.srcObject)return r.srcObject=e,(me.isSafari()||me.isFirefox())&&setTimeout(()=>{r.srcObject=e,r.play().catch(a=>{console.error("Failed to play stream",a)})},0),()=>{r.pause(),r.srcObject=null}},[e,r]),t.jsx("video",{autoPlay:!0,playsInline:!0,...n,ref:a=>{Ne(i,a),o(a)}})});const Ce=l.forwardRef(function({participant:e,style:n,children:i},r){const[o,a]=l.useState(!1),c=e.name||e.userId;return t.jsxs("div",{className:"str-video__video-placeholder",style:n,ref:r,children:[(!e.image||o)&&(c?t.jsx(St,{name:c}):t.jsx("div",{className:"str-video__video-placeholder__no-video-label",children:i})),e.image&&!o&&t.jsx("img",{onError:()=>a(!0),alt:c,className:"str-video__video-placeholder__avatar",src:e.image})]})}),St=s=>{const{name:e}=s,n=e.split(" ").slice(0,2).map(i=>i[0]).join("");return t.jsx("div",{className:"str-video__video-placeholder__initials-fallback",children:n})},jt=l.forwardRef(function(e,n){const{t:i}=C();return t.jsx(Ce,{ref:n,...e,children:i("Video is disabled")})}),bt=l.forwardRef(function(e,n){const{t:i}=C();return t.jsx(Ce,{ref:n,...e,children:i("Video is playing in a popup")})}),we=({enabled:s=!0,mirror:e,trackType:n,participant:i,className:r,VideoPlaceholder:o=jt,PictureInPicturePlaceholder:a=bt,refs:c,...m})=>{const{sessionId:d,videoStream:u,screenShareStream:p,viewportVisibilityState:h,isLocalParticipant:_,userId:S}=i,v=O(),[f,b]=l.useState(null),[j,y]=l.useState(!0),[w,R]=l.useState(!0),U=Pe(f??void 0),A=n==="videoTrack"?u:n==="screenShareTrack"?p:void 0;if(l.useLayoutEffect(()=>{if(!v||!f||n==="none")return;const g=v.bindVideoElement(f,d,n);return()=>{g==null||g()}},[v,n,d,f]),l.useEffect(()=>{if(!A||!f)return;const[g]=A.getVideoTracks();if(!g)return;const T=()=>{y(f.paused);const{width:te=0,height:$=0}=g.getSettings();R(te>=$)};return y(f.paused),f.addEventListener("play",T),f.addEventListener("pause",T),g.addEventListener("unmute",T),()=>{f.removeEventListener("play",T),f.removeEventListener("pause",T),g.removeEventListener("unmute",T),y(!0)}},[A,f]),!v)return null;const M=n==="videoTrack"?J(i):n==="screenShareTrack"?Z(i):!1,V=n==="none"||(h==null?void 0:h[n])===Oe.INVISIBLE,q=!s||!M||V,B=e===void 0?_&&n==="videoTrack":e,k=n==="screenShareTrack";return t.jsxs(t.Fragment,{children:[!q&&t.jsx("video",{...m,className:N("str-video__video",r,{"str-video__video--not-playing":j,"str-video__video--tall":!w,"str-video__video--mirror":B,"str-video__video--screen-share":k}),"data-user-id":S,"data-session-id":d,ref:g=>{var T;b(g),(T=c==null?void 0:c.setVideoElement)==null||T.call(c,g)}}),U&&a&&t.jsx(a,{style:{position:"absolute"},participant:i}),(q||j)&&o&&t.jsx(o,{style:{position:"absolute"},participant:i,ref:c==null?void 0:c.setVideoPlaceholderElement})]})};we.displayName="Video";const yt=({trackedElement:s,dynascaleManager:e,sessionId:n,trackType:i})=>{const r=O(),o=e??(r==null?void 0:r.dynascaleManager);l.useEffect(()=>{if(!s||!o||!r||i==="none")return;const a=o.trackElementVisibility(s,n,i);return()=>{a()}},[s,o,r,n,i])};l.createContext(void 0);const D=l.forwardRef(function(e,n){const{icon:i,enabled:r,variant:o,onClick:a,className:c,...m}=e;return t.jsx("button",{className:N("str-video__call-controls__button",c,{[`str-video__call-controls__button--variant-${o}`]:o,"str-video__call-controls__button--enabled":r}),onClick:d=>{d.preventDefault(),a==null||a(d)},ref:n,...m,children:t.jsx(P,{icon:i})})}),Y=l.forwardRef(function({disabled:e,caption:n,children:i,className:r,active:o,Menu:a,menuPlacement:c,menuOffset:m,title:d,ToggleMenuButton:u=Pt,variant:p,onClick:h,onMenuToggle:_,...S},v){return t.jsxs("div",{className:N("str-video__composite-button",r,{"str-video__composite-button--caption":n,"str-video__composite-button--menu":a}),title:d,ref:v,children:[t.jsxs("div",{className:N("str-video__composite-button__button-group",{"str-video__composite-button__button-group--active":o,"str-video__composite-button__button-group--active-primary":o&&p==="primary","str-video__composite-button__button-group--active-secondary":o&&p==="secondary","str-video__composite-button__button-group--disabled":e}),children:[t.jsx("button",{type:"button",className:"str-video__composite-button__button",onClick:f=>{f.preventDefault(),h==null||h(f)},disabled:e,...S,children:i}),a&&t.jsx(ce,{offset:m,placement:c,ToggleButton:u,onToggle:_,children:ke(a)?t.jsx(a,{}):a})]}),n&&t.jsx("div",{className:"str-video__composite-button__caption",children:n})]})}),Pt=l.forwardRef(function({menuShown:e},n){return t.jsx(D,{className:N("str-video__menu-toggle-button",{"str-video__menu-toggle-button--active":e}),icon:e?"caret-down":"caret-up",ref:n})}),X=s=>{const{isVisible:e,message:n,children:i,visibilityTimeout:r,resetIsVisible:o,placement:a="top",iconClassName:c="str-video__notification__icon",close:m}=s,{refs:d,x:u,y:p,strategy:h}=oe({placement:a,strategy:"absolute"});return l.useEffect(()=>{if(!e||!r||!o)return;const _=setTimeout(()=>{o()},r);return()=>clearTimeout(_)},[e,o,r]),t.jsxs("div",{ref:d.setReference,children:[e&&t.jsxs("div",{className:"str-video__notification",ref:d.setFloating,style:{position:h,top:p??0,left:u??0,overflowY:"auto"},children:[c&&t.jsx("i",{className:c}),t.jsx("span",{className:"str-video__notification__message",children:n}),m?t.jsx("i",{className:"str-video__icon str-video__icon--close str-video__notification__close",onClick:m}):null]}),i]})},le=s=>{const{permission:e,isAwaitingApproval:n,messageApproved:i,messageAwaitingApproval:r,messageRevoked:o,visibilityTimeout:a=3500,children:c}=s,{useHasPermissions:m}=L(),d=m(e),u=l.useRef(d),[p,h]=l.useState();l.useEffect(()=>{d&&!u.current?(h("granted"),u.current=!0):!d&&u.current&&(h("revoked"),u.current=!1)},[d]);const _=l.useCallback(()=>h(void 0),[]);return n?t.jsx(X,{isVisible:n&&!d,message:r,children:c}):t.jsx(X,{isVisible:!!p,visibilityTimeout:a,resetIsVisible:_,message:p==="granted"?i:o,children:c})},kt=({children:s,text:e,placement:n})=>{const{useMicrophoneState:i}=L(),{isSpeakingWhileMuted:r}=i(),{t:o}=C(),a=e??o("You are muted. Unmute to speak.");return t.jsx(X,{message:a,isVisible:r,placement:n||"top-start",children:s})},Nt=({className:s,type:e="spinner",text:n,tooltip:i})=>t.jsxs("div",{className:N("str-video__loading-indicator",s),title:i,children:[t.jsx("div",{className:N("str-video__loading-indicator__icon",e)}),n&&t.jsx("p",{className:"str-video__loading-indicator-text",children:n})]}),Ct=({children:s,referenceElement:e,tooltipClassName:n,tooltipPlacement:i="top",visible:r=!1})=>{const o=l.useRef(null),{refs:a,x:c,y:m,strategy:d,context:u}=oe({placement:i,strategy:"absolute",middleware:[ot({element:o})]});return l.useEffect(()=>{a.setReference(e)},[e,a]),r?t.jsxs("div",{className:N("str-video__tooltip",n),ref:a.setFloating,style:{position:d,top:m??0,left:c??0},children:[t.jsx(Ge,{ref:o,context:u,fill:"var(--str-video__tooltip--background-color)"}),s]}):null},wt=({onMouseEnter:s,onMouseLeave:e}={})=>{const[n,i]=l.useState(!1),r=l.useCallback(a=>{i(!0),s==null||s(a)},[s]),o=l.useCallback(a=>{i(!1),e==null||e(a)},[e]);return{handleMouseEnter:r,handleMouseLeave:o,tooltipVisible:n}},W=({title:s,tooltipClassName:e,tooltipPlacement:n,tooltipDisabled:i,...r})=>{const{handleMouseEnter:o,handleMouseLeave:a,tooltipVisible:c}=wt(),[m,d]=l.useState(null),u=!i&&!!s&&c;return t.jsxs(t.Fragment,{children:[t.jsx(Ct,{referenceElement:m,visible:u,tooltipClassName:e,tooltipPlacement:n,children:s||""}),t.jsx("div",{ref:d,onMouseEnter:o,onMouseLeave:a,...r})]})};l.forwardRef(function(e,n){return t.jsx(Y,{ref:n,active:!0,variant:"secondary","data-testid":"recording-stop-button",children:t.jsx(P,{icon:"recording-off"})})});const Et=({caption:s})=>{const{t:e}=C(),{toggleCallRecording:n,isAwaitingResponse:i,isCallRecordingInProgress:r}=Ye();let o=s??e("Record call");return i&&(o=e(r?"Waiting for recording to stop...":"Waiting for recording to start...")),t.jsx(I,{requiredGrants:[x.START_RECORD_CALL,x.STOP_RECORD_CALL],children:t.jsx(Y,{active:r,caption:s,variant:"secondary","data-testid":r?"recording-stop-button":"recording-start-button",title:o,onClick:i?void 0:n,children:i?t.jsx(Nt,{}):t.jsx(P,{icon:r?"recording-on":"recording-off"})})})},Ee={":like:":"👍",":raise-hand:":"✋",":fireworks:":"🎉",":dislike:":"👎",":heart:":"❤️",":smile:":"😀"},Rt=({participant:{reaction:s,sessionId:e},hideAfterTimeoutInMs:n=5500,emojiReactionMap:i=Ee})=>{const r=O();if(l.useEffect(()=>{if(!r||!s)return;const a=setTimeout(()=>{r.resetReaction(e)},n);return()=>{clearTimeout(a)}},[r,n,s,e]),!s)return null;const{emoji_code:o}=s;return t.jsx("div",{className:"str-video__reaction",children:t.jsx("span",{className:"str-video__reaction__emoji",children:o&&i[o]})})},At=[{type:"reaction",emoji_code:":like:"},{type:"raised-hand",emoji_code:":raise-hand:"},{type:"reaction",emoji_code:":fireworks:"},{type:"reaction",emoji_code:":dislike:"},{type:"reaction",emoji_code:":heart:"},{type:"reaction",emoji_code:":smile:"}],It=({reactions:s=At})=>t.jsx(I,{requiredGrants:[x.CREATE_REACTION],children:t.jsx(ce,{placement:"top",ToggleButton:Tt,visualType:H.MENU,children:t.jsx(Lt,{reactions:s})})}),Tt=l.forwardRef(function({menuShown:e},n){const{t:i}=C();return t.jsx(W,{title:i("Reactions"),tooltipDisabled:e,children:t.jsx(Y,{ref:n,active:e,variant:"primary",children:t.jsx(P,{icon:"reactions"})})})}),Lt=({reactions:s,layout:e="horizontal"})=>{const n=O(),{close:i}=ae();return t.jsx("div",{className:N("str-video__reactions-menu",{"str-video__reactions-menu--horizontal":e==="horizontal","str-video__reactions-menu--vertical":e==="vertical"}),children:s.map(r=>t.jsx("button",{type:"button",className:"str-video__reactions-menu__button",onClick:()=>{n==null||n.sendReaction(r),i==null||i()},children:r.emoji_code&&Ee[r.emoji_code]},r.emoji_code))})},de=(s,e)=>{const n=Me(["react-sdk"]);return async()=>{try{await e()}catch(i){if(s.onError){s.onError(i);return}Dt(i)||n("error","Call control handler failed",i)}}};function Dt(s){return s instanceof DOMException&&s.name==="NotAllowedError"}const Ot=s=>{const{t:e}=C(),{caption:n}=s,{useHasOngoingScreenShare:i,useScreenShareState:r,useCallSettings:o}=L(),a=i(),{hasPermission:c,requestPermission:m,isAwaitingPermission:d}=re(x.SCREENSHARE),u=o(),p=u==null?void 0:u.screensharing.enabled,{screenShare:h,optimisticIsMute:_}=r(),S=!_,v=!S&&(a||p===!1),f=de(s,async()=>{c?await h.toggle():await m()});return t.jsx(I,{requiredGrants:[x.SCREENSHARE],children:t.jsx(le,{permission:x.SCREENSHARE,isAwaitingApproval:d,messageApproved:e("You can now share your screen."),messageAwaitingApproval:e("Awaiting for an approval to share screen."),messageRevoked:e("You can no longer share your screen."),children:t.jsx(W,{title:n??e("Share screen"),children:t.jsx(Y,{active:a||S,caption:n,variant:"primary","data-testid":a?"screen-share-stop-button":"screen-share-start-button",disabled:v,onClick:f,children:t.jsx(P,{icon:a?"screen-share-on":"screen-share-off"})})})})})},Re=l.createContext({}),Mt=s=>{const{children:e,icon:n,defaultSelectedLabel:i,defaultSelectedIndex:r,handleSelect:o}=s,[a,c]=l.useState(!1),[m,d]=l.useState(null),[u,p]=l.useState(r),[h,_]=l.useState(i),{refs:S,context:v}=fe({placement:"bottom-start",open:a,onOpenChange:c,whileElementsMounted:ge,middleware:[_e()]}),f=l.useRef([]),b=l.useRef([]),j=l.useCallback(g=>{p(g),o(g||0),c(!1),g!==null&&_(b.current[g])},[o]),y=g=>{a?d(g):j(g)},w=Je(v,{listRef:f,activeIndex:m,selectedIndex:u,onNavigate:d}),R=We(v,{listRef:b,activeIndex:m,selectedIndex:u,onMatch:y}),U=Ke(v),A=Qe(v),M=Xe(v,{role:"listbox"}),{getReferenceProps:V,getFloatingProps:q,getItemProps:B}=Ze([w,R,U,A,M]),k=l.useMemo(()=>({activeIndex:m,selectedIndex:u,getItemProps:B,handleSelect:j}),[m,u,B,j]);return t.jsxs("div",{className:"str-video__dropdown",children:[t.jsxs("div",{className:"str-video__dropdown-selected",ref:S.setReference,tabIndex:0,...V(),children:[t.jsxs("label",{className:"str-video__dropdown-selected__label",children:[n&&t.jsx(P,{className:"str-video__dropdown-selected__icon",icon:n}),h]}),t.jsx(P,{className:"str-video__dropdown-selected__chevron",icon:a?"chevron-up":"chevron-down"})]}),t.jsx(Re.Provider,{value:k,children:a&&t.jsx(et,{context:v,modal:!1,children:t.jsx("div",{className:"str-video__dropdown-list",ref:S.setFloating,...q(),children:t.jsx(tt,{elementsRef:f,labelsRef:b,children:e})})})})]})},Vt=s=>{const{selected:e,label:n,icon:i}=s,{getItemProps:r,handleSelect:o}=l.useContext(Re),{ref:a,index:c}=ze();return t.jsxs("div",{className:N("str-video__dropdown-option",{"str-video__dropdown-option--selected":e}),ref:a,...r({onClick:()=>o(c)}),children:[i&&t.jsx(P,{className:"str-video__dropdown-icon",icon:i}),t.jsx("span",{className:"str-video__dropdown-label",children:n})]})},qt=s=>{const{children:e,icon:n,handleSelect:i,defaultSelectedLabel:r,defaultSelectedIndex:o}=s;return t.jsx(Mt,{icon:n,handleSelect:i,defaultSelectedIndex:o,defaultSelectedLabel:r,children:e})},Bt=({disabled:s,id:e,label:n,onChange:i,name:r,selected:o,defaultChecked:a,value:c})=>t.jsxs("label",{className:N("str-video__device-settings__option",{"str-video__device-settings__option--selected":o,"str-video__device-settings__option--disabled":s}),htmlFor:e,children:[t.jsx("input",{type:"radio",name:r,onChange:i,value:c,id:e,checked:o,defaultChecked:a,disabled:s}),n]}),Ft=s=>{const{devices:e=[],selectedDeviceId:n,title:i,type:r,onChange:o}=s,{close:a}=ae(),{deviceList:c}=be(e,n);return t.jsxs("div",{className:"str-video__device-settings__device-kind",children:[i&&t.jsx("div",{className:"str-video__device-settings__device-selector-title",children:i}),c.map(m=>t.jsx(Bt,{id:`${r}--${m.deviceId}`,value:m.deviceId,label:m.label,onChange:d=>{const u=d.target.value;u!=="default"&&(o==null||o(u)),a==null||a()},name:r,selected:m.isSelected},m.deviceId))]})},Ut=s=>{const{devices:e=[],selectedDeviceId:n,title:i,onChange:r,icon:o}=s,{deviceList:a,selectedDeviceInfo:c,selectedIndex:m}=be(e,n),d=l.useCallback(u=>{const p=a[u].deviceId;p!=="default"&&(r==null||r(p))},[a,r]);return t.jsxs("div",{className:"str-video__device-settings__device-kind",children:[t.jsx("div",{className:"str-video__device-settings__device-selector-title",children:i}),t.jsx(qt,{icon:o,defaultSelectedIndex:m,defaultSelectedLabel:c.label,handleSelect:d,children:a.map(u=>t.jsx(Vt,{icon:o,label:u.label,selected:u.isSelected},u.deviceId))})]})},Ae=s=>{const{visualType:e="list",icon:n,...i}=s;return e==="list"?t.jsx(Ft,{...i}):t.jsx(Ut,{...i,icon:n})},Yt=({title:s,visualType:e})=>{const{useMicrophoneState:n}=L(),{microphone:i,selectedDevice:r,devices:o}=n();return t.jsx(Ae,{devices:o||[],selectedDeviceId:r,type:"audioinput",onChange:async a=>{await i.select(a)},title:s,visualType:e,icon:"mic"})},$t=({title:s,visualType:e})=>{const{useCameraState:n}=L(),{camera:i,devices:r,selectedDevice:o}=n();return t.jsx(Ae,{devices:r||[],type:"videoinput",selectedDeviceId:o,onChange:async a=>{await i.select(a)},title:s,visualType:e,icon:"camera"})};l.forwardRef(function({menuShown:e},n){const{t:i}=C();return t.jsx(D,{className:N("str-video__device-settings__button",{"str-video__device-settings__button--active":e}),title:i("Toggle device menu"),icon:"device-settings",ref:n})});const Ht=s=>{const{t:e}=C(),{caption:n,Menu:i=t.jsx(Yt,{visualType:"list"}),menuPlacement:r="top",onMenuToggle:o,...a}=s,{hasPermission:c,requestPermission:m,isAwaitingPermission:d}=re(x.SEND_AUDIO),{useMicrophoneState:u}=L(),{microphone:p,optimisticIsMute:h,hasBrowserPermission:_,isPromptingPermission:S}=u(),[v,f]=l.useState(!1),b=de(s,async()=>{c?await p.toggle():await m()});return t.jsx(I,{requiredGrants:[x.SEND_AUDIO],children:t.jsx(le,{permission:x.SEND_AUDIO,isAwaitingApproval:d,messageApproved:e("You can now speak."),messageAwaitingApproval:e("Awaiting for an approval to speak."),messageRevoked:e("You can no longer speak."),children:t.jsx(W,{title:c?_?n??e("Mic"):e("Check your browser mic permissions"):e("You have no permission to share your audio"),tooltipDisabled:v,children:t.jsxs(Y,{active:h,caption:n,variant:"secondary",disabled:!_||!c,"data-testid":h?"audio-unmute-button":"audio-mute-button",onClick:b,Menu:i,menuPlacement:r,menuOffset:16,...a,onMenuToggle:j=>{f(j),o==null||o(j)},children:[t.jsx(P,{icon:h?"mic-off":"mic"}),(!_||!c)&&t.jsx("span",{className:"str-video__no-media-permission",children:"!"}),S&&t.jsx("span",{className:"str-video__pending-permission",title:e("Waiting for permission"),children:"?"})]})})})})},Gt=s=>{const{t:e}=C(),{caption:n,Menu:i=t.jsx($t,{visualType:"list"}),menuPlacement:r="top",onMenuToggle:o,...a}=s,{hasPermission:c,requestPermission:m,isAwaitingPermission:d}=re(x.SEND_VIDEO),{useCameraState:u,useCallSettings:p}=L(),{camera:h,optimisticIsMute:_,hasBrowserPermission:S,isPromptingPermission:v}=u(),f=p(),b=f==null?void 0:f.video.enabled,[j,y]=l.useState(!1),w=de(s,async()=>{c?await h.toggle():await m()});return t.jsx(I,{requiredGrants:[x.SEND_VIDEO],children:t.jsx(le,{permission:x.SEND_VIDEO,isAwaitingApproval:d,messageApproved:e("You can now share your video."),messageAwaitingApproval:e("Awaiting for an approval to share your video."),messageRevoked:e("You can no longer share your video."),children:t.jsx(W,{title:c?S?b?n||e("Video"):e("Video publishing is disabled by the system"):e("Check your browser video permissions"):e("You have no permission to share your video"),tooltipDisabled:j,children:t.jsxs(Y,{active:_,caption:n,variant:"secondary",disabled:!S||!c||!b,"data-testid":_?"video-unmute-button":"video-mute-button",onClick:w,Menu:i,menuPlacement:r,menuOffset:16,...a,onMenuToggle:R=>{y(R),o==null||o(R)},children:[t.jsx(P,{icon:_?"camera-off":"camera"}),(!S||!c||!b)&&t.jsx("span",{className:"str-video__no-media-permission",children:"!"}),v&&t.jsx("span",{className:"str-video__pending-permission",title:e("Waiting for permission"),children:"?"})]})})})})};l.forwardRef(function({menuShown:e},n){const{t:i}=C();return t.jsx(W,{title:i("Leave call"),tooltipDisabled:e,children:t.jsx(D,{icon:e?"close":"call-end",variant:e?"active":"danger","data-testid":"leave-call-button",ref:n})})});const zt=({disabled:s,caption:e,onClick:n,onLeave:i})=>{const r=O(),{t:o}=C(),a=l.useCallback(async c=>{n?n(c):r&&(await r.leave(),i==null||i())},[n,i,r]);return t.jsx(D,{disabled:s,icon:"call-end",variant:"danger",title:e??o("Leave call"),"data-testid":"cancel-call-button",onClick:a})},sn=({onLeave:s})=>t.jsxs("div",{className:"str-video__call-controls",children:[t.jsx(I,{requiredGrants:[x.SEND_AUDIO],children:t.jsx(kt,{children:t.jsx(Ht,{})})}),t.jsx(I,{requiredGrants:[x.SEND_VIDEO],children:t.jsx(Gt,{})}),t.jsx(I,{requiredGrants:[x.CREATE_REACTION],children:t.jsx(It,{})}),t.jsx(I,{requiredGrants:[x.SCREENSHARE],children:t.jsx(Ot,{})}),t.jsx(I,{requiredGrants:[x.START_RECORD_CALL,x.STOP_RECORD_CALL],children:t.jsx(Et,{})}),t.jsx(zt,{onLeave:s})]});l.lazy(()=>ht(()=>Promise.resolve().then(()=>Hs),void 0));var he;(function(s){s.GOOD="Good",s.OK="Ok",s.BAD="Bad"})(he||(he={}));l.forwardRef(function(e,n){const{t:i}=C(),{caption:r,menuShown:o}=e;return t.jsx(Y,{ref:n,active:o,caption:r,title:r||i("Statistics"),"data-testid":"stats-button",children:t.jsx(P,{icon:"stats"})})});l.forwardRef(function(e,n){return t.jsx(D,{enabled:e.menuShown,icon:"ellipsis",ref:n})});l.forwardRef(function(e,n){return t.jsx(D,{enabled:e.menuShown,icon:"filter",ref:n})});l.createContext(null);F.JOINING+"",F.RINGING+"",F.MIGRATING+"",F.RECONNECTING+"",F.RECONNECTING_FAILED+"",F.OFFLINE+"",F.IDLE+"",F.UNKNOWN+"",F.JOINED+"",F.LEFT+"";l.forwardRef(function(e,n){const{permissionRequests:i,handleUpdatePermission:r,...o}=e,{t:a}=C();return t.jsx("div",{className:"str-video__permission-requests-list",ref:n,...o,children:i.map((c,m)=>{const{user:d,permissions:u}=c;return t.jsx(l.Fragment,{children:u.map(p=>t.jsxs("div",{className:"str-video__permission-request",children:[t.jsx("div",{className:"str-video__permission-request__message",children:Jt(d.name||d.id,p,a)}),t.jsx(se,{className:"str-video__permission-request__button--allow",type:"button",onClick:r(c,"grant"),children:a("Allow")}),t.jsx(se,{className:"str-video__permission-request__button--reject",type:"button",onClick:r(c,"revoke"),children:a("Revoke")}),t.jsx(se,{className:"str-video__permission-request__button--reject",type:"button",onClick:r(c,"dismiss"),children:a("Dismiss")})]},p))},`${d.id}/${m}`)})})});const se=s=>{const{className:e,...n}=s;return t.jsx("button",{className:N("str-video__permission-request__button",e),...n})},Jt=(s,e,n)=>{switch(e){case x.SEND_AUDIO:return n("{{ userName }} is requesting to speak",{userName:s});case x.SEND_VIDEO:return n("{{ userName }} is requesting to share their camera",{userName:s});case x.SCREENSHARE:return n("{{ userName }} is requesting to present their screen",{userName:s});default:return n("{{ userName }} is requesting permission: {{ permission }}",{userName:s,permission:e})}},nn=({as:s="div",className:e,children:n,...i})=>t.jsx(s,{...i,className:N("str-video",e),children:n}),Wt=l.forwardRef(function(e,n){return t.jsx(D,{enabled:e.menuShown,icon:"ellipsis",ref:n})}),Kt=()=>{const s=O(),{t:e}=C(),n=()=>{s==null||s.screenShare.disable()};return t.jsxs("div",{className:"str-video__screen-share-overlay",children:[t.jsx(P,{icon:"screen-share-off"}),t.jsx("span",{className:"str-video__screen-share-overlay__title",children:e("You are presenting your screen")}),t.jsxs("button",{onClick:n,className:"str-video__screen-share-overlay__button",children:[t.jsx(P,{icon:"close"})," ",e("Stop Screen Sharing")]})]})},ue=({indicatorsVisible:s=!0,menuPlacement:e="bottom-start",showMenuButton:n=!0,ParticipantActionsContextMenu:i=xt})=>{const{participant:r,trackType:o}=ee(),a=Z(r);return r.isLocalParticipant&&a&&o==="screenShareTrack"?t.jsxs(t.Fragment,{children:[t.jsx(Kt,{}),t.jsx(ve,{indicatorsVisible:s})]}):t.jsxs(t.Fragment,{children:[n&&t.jsx(ce,{strategy:"fixed",placement:e,ToggleButton:Wt,children:t.jsx(i,{})}),t.jsx(Rt,{participant:r}),t.jsx(ve,{indicatorsVisible:s})]})},ve=({indicatorsVisible:s=!0})=>{const{participant:e}=ee(),{isLocalParticipant:n,connectionQuality:i,pin:r,sessionId:o,name:a,userId:c}=e,m=O(),{t:d}=C(),u=!!i&&ne.ConnectionQuality[i].toLowerCase(),p=z(e),h=J(e),_=!!r&&r.isLocalPin;return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"str-video__participant-details",children:t.jsxs("span",{className:"str-video__participant-details__name",children:[a||c,s&&!p&&t.jsx("span",{className:"str-video__participant-details__name--audio-muted"}),s&&!h&&t.jsx("span",{className:"str-video__participant-details__name--video-muted"}),s&&_&&t.jsx("span",{title:d("Unpin"),onClick:()=>m==null?void 0:m.unpin(o),className:"str-video__participant-details__name--pinned"}),s&&t.jsx(Qt,{})]})}),s&&t.jsx(X,{isVisible:n&&i===ne.ConnectionQuality.POOR,message:d("Poor connection quality"),children:u&&t.jsx("span",{className:N("str-video__participant-details__connection-quality",`str-video__participant-details__connection-quality--${u}`),title:u})})]})},Qt=()=>{const{participant:s}=ee(),{isSpeaking:e,isDominantSpeaker:n}=s;return t.jsxs("span",{className:N("str-video__speech-indicator",e&&"str-video__speech-indicator--speaking",n&&"str-video__speech-indicator--dominant"),children:[t.jsx("span",{className:"str-video__speech-indicator__bar"}),t.jsx("span",{className:"str-video__speech-indicator__bar"}),t.jsx("span",{className:"str-video__speech-indicator__bar"})]})},K=l.forwardRef(function({participant:e,trackType:n="videoTrack",mirror:i,muteAudio:r,refs:{setVideoElement:o,setVideoPlaceholderElement:a}={},className:c,VideoPlaceholder:m,PictureInPicturePlaceholder:d,ParticipantViewUI:u=ue},p){const{isLocalParticipant:h,isSpeaking:_,isDominantSpeaker:S,sessionId:v}=e,f=z(e),b=J(e),j=ie(e),[y,w]=l.useState(null),[R,U]=l.useState(null),[A,M]=l.useState(null);yt({sessionId:v,trackedElement:y,trackType:n});const{useIncomingVideoSettings:V}=L(),{isParticipantVideoEnabled:q}=V(),B=l.useMemo(()=>({participant:e,participantViewElement:y,videoElement:R,videoPlaceholderElement:A,trackType:n}),[R,A,e,y,n]),k=l.useMemo(()=>({setVideoElement:g=>{o==null||o(g),U(g)},setVideoPlaceholderElement:g=>{a==null||a(g),M(g)}}),[o,a]);return t.jsx("div",{"data-testid":"participant-view",ref:g=>{Ne(p,g),w(g)},className:N("str-video__participant-view",S&&"str-video__participant-view--dominant-speaker",_&&"str-video__participant-view--speaking",!b&&"str-video__participant-view--no-video",!f&&"str-video__participant-view--no-audio",c),children:t.jsxs(Se.Provider,{value:B,children:[!h&&!r&&t.jsxs(t.Fragment,{children:[f&&t.jsx(G,{participant:e,trackType:"audioTrack"}),j&&t.jsx(G,{participant:e,trackType:"screenShareAudioTrack"})]}),t.jsx(we,{VideoPlaceholder:m,PictureInPicturePlaceholder:d,participant:e,trackType:n,refs:k,enabled:h||n!=="videoTrack"||q(e.sessionId),mirror:i,autoPlay:!0}),ke(u)?t.jsx(u,{}):u]})})});K.displayName="ParticipantView";const Xt=Fe;Xt.displayName="StreamCall";var Zt="Joining",es="Mic",ts="Ringing",ss="Speakers",ns="Video",is="Live",os="Reactions",rs="Statistics",as="Invite",cs="Join",ls="You",ds="Me",us="Unknown",ms="Default",ps="Refresh",hs="Allow",vs="Revoke",fs="Dismiss",_s="Pinned",gs="Unpin",xs="Pin",Ss="Block",js="Enter",bs="Leave",ys="Participants",Ps=", and ({{ count }}) anonymous",ks={Joining:Zt,Mic:es,"No internet connection":"No internet connection","Re-connecting":"Re-connecting",Ringing:ts,"Screen Share":"Screen Share","Select a Camera":"Select a Camera","Select a Mic":"Select a Mic","Select Speakers":"Select Speakers",Speakers:ss,Video:ns,"You are muted. Unmute to speak.":"You are muted. Unmute to speak.",Live:is,"Livestream starts soon":"Livestream starts soon","Livestream starts at {{ startsAt }}":"Livestream starts at {{ startsAt, datetime }}","{{ count }} participants joined early_one":"{{ count }} participant joined early","{{ count }} participants joined early_other":"{{ count }} participants joined early","You can now speak.":"You can now speak.","Awaiting for an approval to speak.":"Awaiting for an approval to speak.","You can no longer speak.":"You can no longer speak.","You can now share your video.":"You can now share your video.","Awaiting for an approval to share your video.":"Awaiting for an approval to share your video.","You can no longer share your video.":"You can no longer share your video.","Waiting for recording to stop...":"Waiting for recording to stop...","Waiting for recording to start...":"Waiting for recording to start...","Record call":"Record call",Reactions:os,Statistics:rs,"You can now share your screen.":"You can now share your screen.","Awaiting for an approval to share screen.":"Awaiting for an approval to share screen.","You can no longer share your screen.":"You can no longer share your screen.","Share screen":"Share screen","Incoming Call...":"Incoming Call...","Calling...":"Calling...","Mute All":"Mute All",Invite:as,Join:cs,You:ls,Me:ds,Unknown:us,"Toggle device menu":"Toggle device menu",Default:ms,"Call Recordings":"Call Recordings",Refresh:ps,"Check your browser video permissions":"Check your browser video permissions","Video publishing is disabled by the system":"Video publishing is disabled by the system","You have no permission to share your video":"You have no permission to share your video","You have no permission to share your audio":"You have no permission to share your audio","You are presenting your screen":"You are presenting your screen","Stop Screen Sharing":"Stop Screen Sharing",Allow:hs,Revoke:vs,Dismiss:fs,"Microphone on":"Microphone on","Microphone off":"Microphone off","Camera on":"Camera on","Camera off":"Camera off","No camera found":"No camera found","Video is disabled":"Video is disabled",Pinned:_s,Unpin:gs,Pin:xs,"Pin for everyone":"Pin for everyone","Unpin for everyone":"Unpin for everyone",Block:Ss,"Turn off video":"Turn off video","Turn off screen share":"Turn off screen share","Mute audio":"Mute audio","Mute screen share audio":"Mute screen share audio","Allow audio":"Allow audio","Allow video":"Allow video","Allow screen sharing":"Allow screen sharing","Disable audio":"Disable audio","Disable video":"Disable video","Disable screen sharing":"Disable screen sharing",Enter:js,Leave:bs,"Leave call":"Leave call","End call for all":"End call for all","{{ direction }} fullscreen":"{{ direction }} fullscreen","{{ direction }} picture-in-picture":"{{ direction }} picture-in-picture","Dominant Speaker":"Dominant Speaker","Poor connection quality":"Poor connection quality. Please check your internet connection.",Participants:ys,Anonymous:Ps,"No participants found":"No participants found","Participants ({{ numberOfParticipants }})":"Participants ({{ numberOfParticipants }})","{{ userName }} is sharing their screen":"{{ userName }} is sharing their screen","{{ userName }} is requesting to speak":"{{ userName }} is requesting to speak","{{ userName }} is requesting to share their camera":"{{ userName }} is requesting to share their camera","{{ userName }} is requesting to present their screen":"{{ userName }} is requesting to present their screen","{{ userName }} is requesting permission: {{ permission }}":"{{ userName }} is requesting permission: {{ permission }}"};const Ns={en:ks},Cs=s=>t.jsx(Ue,{translationsOverrides:Ns,...s});Cs.displayName="StreamVideo";function Q(s,e){return"$and"in e?e.$and.every(n=>Q(s,n)):"$or"in e?e.$or.some(n=>Q(s,n)):"$not"in e?!Q(s,e.$not):ws(s,e)}function ws(s,e){let n=!0;for(const i of Object.keys(e)){const r=e[i],o=r&&typeof r=="object",a=s[i];if(o&&"$eq"in r)n&&(n=r.$eq===a);else if(o&&"$neq"in r)n&&(n=r.$neq!==a);else if(o&&"$in"in r)n&&(n=r.$in.includes(a));else if(o&&"$contains"in r)if(Array.isArray(a)){const c=r;n&&(n=a.includes(c.$contains))}else n=!1;else n&&(n=r===a);if(!n)return!1}return!0}const Es=({excludeLocalParticipant:s=!1,filterParticipants:e})=>{const{useParticipants:n,useRemoteParticipants:i}=L(),r=n(),o=i();return l.useMemo(()=>{const a=s?o:r;return e?Rs(a,e):a},[r,o,s,e])},Rs=(s,e)=>{const n=typeof e=="function"?e:i=>Q({userId:i.userId,isSpeaking:i.isSpeaking,isDominantSpeaker:i.isDominantSpeaker,name:i.name,roles:i.roles,isPinned:Ve(i),hasVideo:J(i),hasAudio:z(i)},e);return s.filter(n)},As=(s,e)=>{l.useEffect(()=>{if(s)return e?s.setSortParticipantsBy(Ie(qe,Ls)):s.setSortParticipantsBy(Te),()=>{Ts(s)}},[s,e])},Is=()=>{const{useRawParticipants:s}=L(),e=s();return l.useMemo(()=>e.filter(n=>!n.isLocalParticipant),[e])},Ts=s=>{const e=Le.get(s.type);s.setSortParticipantsBy(e.options.sortParticipantsBy||De)},Ls=(s,e)=>s.isLocalParticipant?1:e.isLocalParticipant?-1:0,Ds=(s,e,n)=>{const[i,r]=l.useState({vertical:typeof n=="number"?n:null,horizontal:typeof n=="number"?n:null});return l.useEffect(()=>{if(!e||!s||typeof n=="number"||typeof n>"u")return;let o=null,a=null;const c=new ResizeObserver((m,d)=>{if(m.length>1){const h=e.firstChild;h&&(a=h.clientHeight,o=h.clientWidth,d.unobserve(e))}if(a===null||o===null)return;const u=Math.floor(s.clientHeight/a),p=Math.floor(s.clientWidth/o);r(h=>h.vertical!==u||h.horizontal!==p?{vertical:u,horizontal:p}:h)});return c.observe(s),c.observe(e),()=>{c.disconnect()}},[e,n,s]),i},Os=()=>t.jsx(ue,{menuPlacement:"top-end"}),Ms=({ParticipantViewUIBar:s=Os,ParticipantViewUISpotlight:e=ue,VideoPlaceholder:n,PictureInPicturePlaceholder:i,participantsBarPosition:r="bottom",participantsBarLimit:o,mirrorLocalParticipantVideo:a=!0,excludeLocalParticipant:c=!1,filterParticipants:m,pageArrowsVisible:d=!0,muted:u})=>{const p=O(),{useParticipants:h}=L(),_=h(),S=Is(),[v,...f]=Es({excludeLocalParticipant:c,filterParticipants:m}),[b,j]=l.useState(null),[y,w]=l.useState(null),[R,U]=l.useState(null),A=v&&Z(v),M=Ds(R,y,o),V=r==="left"||r==="right",q=r==="top"||r==="bottom";l.useEffect(()=>{if(!b||!p)return;const $=p.setViewport(b);return()=>$()},[b,p]);const B=_.length===2;As(p,B);let k=f;const g=V?M.vertical:M.horizontal;typeof o<"u"&&g!==null&&(k=f.slice(0,g-(A?1:0)));const T=a?void 0:!1;if(!p)return null;const te=r&&(k.length>0||A);return t.jsxs("div",{className:"str-video__speaker-layout__wrapper",children:[!u&&t.jsx(xe,{participants:S}),t.jsxs("div",{className:N("str-video__speaker-layout",r&&`str-video__speaker-layout--variant-${r}`),children:[t.jsx("div",{className:"str-video__speaker-layout__spotlight",children:v&&t.jsx(K,{participant:v,muteAudio:!0,mirror:T,trackType:A?"screenShareTrack":"videoTrack",ParticipantViewUI:e,VideoPlaceholder:n,PictureInPicturePlaceholder:i})}),te&&t.jsxs("div",{ref:U,className:"str-video__speaker-layout__participants-bar-buttons-wrapper",children:[t.jsx("div",{className:"str-video__speaker-layout__participants-bar-wrapper",ref:j,children:t.jsxs("div",{ref:w,className:"str-video__speaker-layout__participants-bar",children:[A&&t.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:t.jsx(K,{participant:v,ParticipantViewUI:s,VideoPlaceholder:n,PictureInPicturePlaceholder:i,mirror:T,muteAudio:!0})},v.sessionId),k.map($=>t.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:t.jsx(K,{participant:$,ParticipantViewUI:s,VideoPlaceholder:n,PictureInPicturePlaceholder:i,mirror:T,muteAudio:!0})},$.sessionId))]})}),d&&V&&t.jsx(qs,{scrollWrapper:b}),d&&q&&t.jsx(Vs,{scrollWrapper:b})]})]})]})};Ms.displayName="SpeakerLayout";const Vs=({scrollWrapper:s})=>{const e=ft(s),n=()=>{s==null||s.scrollBy({left:-150,behavior:"smooth"})},i=()=>{s==null||s.scrollBy({left:150,behavior:"smooth"})};return t.jsxs(t.Fragment,{children:[e&&e!=="start"&&t.jsx(D,{onClick:n,icon:"caret-left",className:"str-video__speaker-layout__participants-bar--button-left"}),e&&e!=="end"&&t.jsx(D,{onClick:i,icon:"caret-right",className:"str-video__speaker-layout__participants-bar--button-right"})]})},qs=({scrollWrapper:s})=>{const e=vt(s),n=()=>{s==null||s.scrollBy({top:-150,behavior:"smooth"})},i=()=>{s==null||s.scrollBy({top:150,behavior:"smooth"})};return t.jsxs(t.Fragment,{children:[e&&e!=="top"&&t.jsx(D,{onClick:n,icon:"caret-up",className:"str-video__speaker-layout__participants-bar--button-top"}),e&&e!=="bottom"&&t.jsx(D,{onClick:i,icon:"caret-down",className:"str-video__speaker-layout__participants-bar--button-bottom"})]})},[Bs,Fs,Us]="1.18.6".split(".");Be({type:ne.SdkType.REACT,major:Bs,minor:Fs,patch:Us});rt.register(at,ct,lt,dt);const Ys=s=>{const{values:e}=s;let n=0;const i={labels:e.map(o=>{const a=new Date(o.x*1e3);return`${a.getHours()}:${a.getMinutes()}`}),datasets:[{data:e.map(o=>{const{y:a}=o;return n=Math.max(n,a),o}),borderColor:"#00e2a1",backgroundColor:"#00e2a1"}]},r=l.useMemo(()=>$s(n),[n]);return t.jsx("div",{className:"str-video__call-stats-line-chart-container",children:t.jsx(ut,{options:r,data:i,className:"str-video__call-stats__latencychart"})})},$s=s=>({maintainAspectRatio:!1,animation:{duration:0},elements:{line:{borderWidth:1},point:{radius:2}},scales:{y:{position:"right",stacked:!0,min:0,max:Math.max(180,Math.ceil((s+10)/10)*10),grid:{display:!0,color:"#979ca0"},ticks:{stepSize:30}},x:{grid:{display:!1},ticks:{display:!1}}}}),Hs=Object.freeze(Object.defineProperty({__proto__:null,default:Ys},Symbol.toStringTag,{value:"Module"}));export{sn as C,Cs as S,ht as _,Xt as a,nn as b,Ms as c};
